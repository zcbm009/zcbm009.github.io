<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>FastDFS使用与部署相关问题 - zcbm-blog</title><meta name="description" content="FastDFS使用与部署相关问题 [TOC] 分为三个角色：client、storage、tracker，其中后两者可以以组或者是集群的方式出现，也就是有多个服务器；client需要向FastDFS上传文件时，需要先从tracker中获取storage中的相关信息，以知道哪些storage可用以及服务器的地址；client向storage上传文件并保存后得到文件的id，client可通过此id访问storage中的目标文件；storage会与tracker进行定时联系以告知tracker当下storage的状态。 以上过程可知配置中要有几个点：storage要注意保存文件的位置；storage要注意tracker的访问地址。 参考内容及答案 Portainer install on LInux 进入网站https://registry.hub.docker.com查询镜像名称，选择使用season/fastdfs 方式一：docker run 基于镜像创建容器并运行 docker run --name fastdfs-tracker season/fastdfs tracker，使用镜像创建名为fastdfs-tracker的容器实例； docker&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://zcbm009.github.io/fastdfsshi-yong-yu-bu-shu-xiang-guan-wen-ti.html"><link rel="alternate" type="application/atom+xml" href="https://zcbm009.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://zcbm009.github.io/feed.json"><meta property="og:title" content="FastDFS使用与部署相关问题"><meta property="og:site_name" content="zcbm-blog"><meta property="og:description" content="FastDFS使用与部署相关问题 [TOC] 分为三个角色：client、storage、tracker，其中后两者可以以组或者是集群的方式出现，也就是有多个服务器；client需要向FastDFS上传文件时，需要先从tracker中获取storage中的相关信息，以知道哪些storage可用以及服务器的地址；client向storage上传文件并保存后得到文件的id，client可通过此id访问storage中的目标文件；storage会与tracker进行定时联系以告知tracker当下storage的状态。 以上过程可知配置中要有几个点：storage要注意保存文件的位置；storage要注意tracker的访问地址。 参考内容及答案 Portainer install on LInux 进入网站https://registry.hub.docker.com查询镜像名称，选择使用season/fastdfs 方式一：docker run 基于镜像创建容器并运行 docker run --name fastdfs-tracker season/fastdfs tracker，使用镜像创建名为fastdfs-tracker的容器实例； docker&hellip;"><meta property="og:url" content="https://zcbm009.github.io/fastdfsshi-yong-yu-bu-shu-xiang-guan-wen-ti.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://zcbm009.github.io/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://zcbm009.github.io/assets/css/style.css?v=fb727e5c6a4bcfd0371f2f90c98750fb"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://zcbm009.github.io/fastdfsshi-yong-yu-bu-shu-xiang-guan-wen-ti.html"},"headline":"FastDFS使用与部署相关问题","datePublished":"2022-03-19T15:36","dateModified":"2022-03-19T18:42","description":"FastDFS使用与部署相关问题 [TOC] 分为三个角色：client、storage、tracker，其中后两者可以以组或者是集群的方式出现，也就是有多个服务器；client需要向FastDFS上传文件时，需要先从tracker中获取storage中的相关信息，以知道哪些storage可用以及服务器的地址；client向storage上传文件并保存后得到文件的id，client可通过此id访问storage中的目标文件；storage会与tracker进行定时联系以告知tracker当下storage的状态。 以上过程可知配置中要有几个点：storage要注意保存文件的位置；storage要注意tracker的访问地址。 参考内容及答案 Portainer install on LInux 进入网站https://registry.hub.docker.com查询镜像名称，选择使用season/fastdfs 方式一：docker run 基于镜像创建容器并运行 docker run --name fastdfs-tracker season/fastdfs tracker，使用镜像创建名为fastdfs-tracker的容器实例； docker&hellip;","author":{"@type":"Person","name":"zcbm","url":"https://zcbm009.github.io/authors/zcbm/"},"publisher":{"@type":"Organization","name":"zcbm"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://zcbm009.github.io/"><strong>zcbm-blog</strong></a></header><article class="post"><header class="main post__header"><time datetime="2022-03-19T15:36" class="post__date">三月 19, 2022</time><h1>FastDFS使用与部署相关问题</h1></header><div class="post__inner post__entry"><h2 id="fastdfs使用与部署相关问题">FastDFS使用与部署相关问题</h2><p>[TOC]</p><h3 id="一、fastdfs基本知识">一、FastDFS基本知识</h3><h4 id="1、fastdfs的定位及功能">1、FastDFS的定位及功能</h4><h4 id="2、fastdfs的基本架构">2、FastDFS的基本架构</h4><h4 id="3、fastdfs整个组件之间的协作过程">3、FastDFS整个组件之间的协作过程</h4><p>分为三个角色：client、storage、tracker，其中后两者可以以组或者是集群的方式出现，也就是有多个服务器；client需要向FastDFS上传文件时，需要先从tracker中获取storage中的相关信息，以知道哪些storage可用以及服务器的地址；client向storage上传文件并保存后得到文件的id，client可通过此id访问storage中的目标文件；storage会与tracker进行定时联系以告知tracker当下storage的状态。</p><p>以上过程可知配置中要有几个点：storage要注意保存文件的位置；storage要注意tracker的访问地址。</p><p><a href="https://github.com/happyfish100/fastdfs/blob/master/README_zh.md">参考内容及答案</a></p><h3 id="二、docker部署fastdfs">二、Docker部署FastDFS</h3><h4 id="1、docker相关命令（与问题相关）">1、Docker相关命令（与问题相关）</h4><h5 id="docker可视化管理工具">Docker可视化管理工具</h5><p><a href="https://docs.portainer.io/v/ce-2.11/start/install/server/docker/linux">Portainer install on LInux</a></p><h5 id="查询目标镜像">查询目标镜像</h5><p>进入网站<code>https://registry.hub.docker.com</code>查询镜像名称，选择使用<code>season/fastdfs</code></p><h5 id="拉取镜像并运行容器的方式">拉取镜像并运行容器的方式</h5><p><strong>方式一：<code>docker run</code> 基于镜像创建容器并运行</strong></p><p><code>docker run --name fastdfs-tracker season/fastdfs tracker</code>，使用镜像创建名为<code>fastdfs-tracker</code>的容器实例；</p><p><code>docker run--name fastdfs-tracker -p 22122:22122 season/fastdfs tracker</code> :创建容器实例并将容器内的端口绑定到宿主机的端口，这样宿主机应用程序就可以访问到容器实例中的服务，参数中前者为容器端口，后者为宿主机端口；</p><p><code>docker run --name fastdfs-tracker -p 22122:22122 -v /etc/fastdfs/store-path:/fdfs/data/store/path season/fastdfs tracker</code>:创建容器后需要进行各种各样的配置，<u>此时文件需要在宿主机与容器实例中频繁复制，而且宿主机无法仅仅通过访问端口的方式访问到容器实例中的文件数据</u>，这时可以将需要访问的文件与需要配置的内容与宿主机目录相绑定，这样就可以方便的访问到容器实例中的内容而不需要再来回的复制；</p><p><code>docker run --name fastdfs-tracker --net=host -v /etc/fastdfs/store-path:/fdfs/data/store/path season/fastdfs tracker</code>：如果容器需要使用到非常多的端口，<code>-p</code>参数需要非常冗长的内容，那么就可以使用<code>--net=host</code>，使用这种方式容器将不再有独立的ip，将会与宿主机分享ip并将容器中使用的各个端口直接绑定到宿主机中，这也意味着-p命令会被忽略；</p><p><code>docker run -d --name fastdfs-tracker season/fastdfs tracker</code>：<code>-d</code>在后台中运行实例，不会因为容器的运行结束而进入终止状态</p><p><code>docker run -e TRACKER_SERVER:192.168.1.2:22122 --name fastdfs-tracker season/fastdfs tracker</code>：镜像会提供一系列的环境变量，可以使用<code>-e</code>参数为环境变量赋值，这样可以省去很多需要配置的内容。</p><p><code>--restart=always</code>容器启动时启用实例</p><p><strong>方式二：docker run命令的拆解</strong></p><p><code>docker pull season/fastdfs</code> ：拉取镜像</p><p><code>docker create --name=fastdfs-tracker season/fastdfs</code>：基于镜像创建容器实例，但是未运行</p><p><code>docker start fastdfs-tracker</code> ：运行容器实例</p><blockquote><p>docker run参数就是以上三个条例的集合，另外，git fetch就是git pull + merge</p></blockquote><h5 id="其他命令">其他命令</h5><p><code>docker restart fastdfs-tracker</code>：重启实例</p><p><code>docker stop fastdfs-tracker</code>：停止实例</p><p><code>docker logs fastdfs-tracker</code>：查看容器的运行日志</p><p><code>docker rm fastdfs-tracker</code>：删除容器</p><h5 id="参考内容">参考内容</h5><p><a href="https://www.cnblogs.com/sdu20112013/p/12867561.html">docker的–net=host有什么用</a></p><p><a href="https://docs.docker.com/network/host/">docker:Use host networking</a></p><p><a href="https://blog.csdn.net/tilyp/article/details/103371360">–net=host</a></p><h4 id="2、fastdfs部署过程">2、FastDFS部署过程</h4><h5 id="linux相关命令">linux相关命令</h5><p><strong>服务相关</strong></p><p>查看服务状态：<code>systemctl status docker</code></p><p>启动服务：<code>systemctl start docker</code></p><p>重启服务：<code>systemctl reload dokcer</code></p><p>终止服务：<code>systemctl stop docker</code></p><p><strong>防火墙端口相关</strong></p><p>查看防火墙状态：<code>firewall-cmd --state</code></p><p>查看已经开放的端口：<code>firewall-cmd --list-ports</code></p><p>添加开放端口（永久）：<code>firewall-cmd --permanent --add-port=22122/tcp</code></p><p>添加端口后需要重启防火墙：<code>firewall-cmd --reload</code></p><h5 id="fdfs部署相关">fdfs部署相关</h5><ol><li><p>在docker中拉取镜像</p></li><li><p>创建实例</p><p>创建tracker实例：</p><pre><code class="language-shell"># docker run -d --name fastdfs-tracker -v /etc/fastdfs_data/tracker_data:/fastdfs/tracker/data -v /etc/fastdfs_data/tracker_config:/fdfs_conf --net=host season/fastdfs tracker
# 上面的语句将配置文件给绑定到宿主机了，这个需要自己准备配置文件
docker run -d --name fastdfs-tracker -v /etc/fastdfs_data/tracker_data:/fastdfs/tracker/data --net=host season/fastdfs tracker
</code></pre><p>创建storage实例：</p><pre><code class="language-shell"># docker run -d --name fastdfs-storage -v /etc/fastdfs_data/storage_data:/fastdfs/storage/data -v /etc/fastdfs_data/store_path:/fastdfs/store_path -v /etc/fastdfs_data/storage_config:/fdfs_conf --net=host -e TRACKER_SERVER:192.168.242.129:22122 season/fastdfs storage
# 不使用理由与tracker相同
docker run -d --name fastdfs-storage -v /etc/fastdfs_data/storage_data:/fastdfs/storage/data -v /etc/fastdfs_data/store_path:/fastdfs/store_path --net=host -e TRACKER_SERVER:192.168.242.129:22122 season/fastdfs storage
</code></pre><p><u>需要注意要绑定文件的位置，另外还需要注意一下访问目录的权限</u></p></li><li><p>配置文件处理</p><p>将配置文件复制到宿主机并调整</p><pre><code class="language-shell"># 要配置文件运行在容器中，修改的配置文件中的目录是在容器的位置
docker cp fastdfs-storage:/fdfs_conf/ /etc/fastdfs_data/storage_config/
# storage: client.conf--修改base_path
docker cp /etc/fastdfs_data/storage_config/fdfs_conf/client.conf fastdfs-storage:/fdfs_conf/client.conf 
docker cp /etc/fastdfs_data/storage_config/fdfs_conf/storage.conf fastdfs-storage:/fdfs_conf/

# tracker
docker cp fastdfs-tracker:/fdfs_conf/ /etc/fastdfs_data/tracker_config/
docker cp /etc/fastdfs_data/tracker_config/fdfs_conf/client.conf fastdfs-tracker:/fdfs_conf/ 
docker cp /etc/fastdfs_data/tracker_config/fdfs_conf/storage.conf fastdfs-tracker:/fdfs_conf/ 

# 在storage中执行，查看服务器之间的关系性
fdfs_monitor /fdfs_conf/storage.conf
</code></pre></li></ol><h5 id="参考内容-1">参考内容</h5><p><a href="https://blog.csdn.net/wufewu/article/details/84801600">docker安装fastdfs</a></p><p><a href="https://registry.hub.docker.com/r/season/fastdfs">docker hub</a></p><h4 id="3、上传测试">3、上传测试</h4><p><strong>linux内测试</strong></p><pre><code class="language-shell">docker run -tid --name fdfs_sh --net=host season/fastdfs sh
# 将storage.conf文件拷贝入以上容器中
docker cp /etc/fastdfs_data/storage_config/fdfs_conf/storage.conf  fdfs_sh:/fdfs_conf/
# 进入容器执行命令
echo &#39;123123&#39; &gt; test.txt
fdfs_upload_file /fdfs_conf/storage.conf /test.txt
# 得到文件Id，去宿主机查看文件内容进行验证
# group1/M00/00/00/wKjygWI0mkiAJp0wAAAABncc3SA778.txt
</code></pre><p><strong>Java客户端测试</strong></p><p><a href="https://github.com/tobato/FastDFS_Client">SpringBootStater:JavaClient客户端</a></p><p><a href="https://github.com/happyfish100/fastdfs-client-java">JavaClient客户端</a></p><h3 id="三、nginx访问上传的内容">三、nginx访问上传的内容</h3><h4 id="1、root与alias的区别">1、root与alias的区别</h4><h4 id="2、在docker中部署nginx并代理静态目录">2、在docker中部署nginx并代理静态目录</h4><pre><code class="language-shell"># 必须要将目标静态资源与容器内的文件绑定，因为容器内访问不到宿主机的目录
docker run -d --name fastdfs-nginx -v /etc/fastdfs_data/store_path/data:/opt -p 12305:80 nginx
docker cp fastdfs-nginx:/etc/nginx/nginx.conf /etc/fastdfs_data/nginx_config/
docker cp /etc/fastdfs_data/nginx_config/nginx.conf fastdfs-nginx:/etc/nginx/

docker cp fastdfs-nginx:/var/log/nginx/error.log /etc/fastdfs_data/logs/
</code></pre><p>存在403访问的问题，估计是因为location的正则表达式的匹配问题</p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on 三月 19, 2022</p><div class="post__share"><h3>Share post:</h3></div><div class="post__bio"><div><h3><a href="https://zcbm009.github.io/authors/zcbm/" class="invert" rel="author">zcbm</a></h3></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><div id="search" class="alt"><form action="https://zcbm009.github.io/search.html" class="search__form"><input class="search__input" type="search" name="q" placeholder="search..." aria-label="search..."></form></div><nav id="menu"><header class="major"><h2>Menu</h2></header><ul><li><a href="https://zcbm009.github.io/tags/" target="_self">TAGS</a></li></ul></nav><section><header class="major"><h2>Get in touch</h2></header><p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus,ac varius enim lorem ullamcorper dolore. Proin sed aliqu facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p><ul class="contact"><li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li><li class="icon solid fa-phone">(000) 000-0000</li><li class="icon solid fa-home">1234 Somewhere Road #8254<br>Nashville, TN 00000-0000</li></ul></section><footer id="footer"><p class="copyright">© Editorial 2 - All rights reserved<br>Design by: <a href="https://html5up.net" target="_blank" rel="noopener">HTML5 UP</a>, Powered by Publii</p></footer></div></div></div><script src="https://zcbm009.github.io/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://zcbm009.github.io/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://zcbm009.github.io/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://zcbm009.github.io/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://zcbm009.github.io/assets/js/main.min.js?v=08add7f6d435054ad38ec38d7cf8be40"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>